<div class="invoice-container">
  <!-- Header -->
  <div class="header">
    <h2>Nueva factura</h2>
    <div class="button-row">
      <button class="add-invoice-button" (click)="handleSave()">Guardar factura</button>
    </div>
  </div>

  <!-- Body -->
  <div class="body">
    <!-- Primera fila -->
    <div class="form-row">
      <!-- <label for="cliente">Cliente</label>
      <input type="text" id="cliente" name="cliente" [(ngModel)]="inputValue" (input)="onInput($event)">

      <div id="autocomplete-results" class="autocomplete-results">
        <div *ngFor="let option of filteredOptions" (click)="selectOption(option)">
          {{ option }}
        </div>
      </div> -->

      <label for="cliente">Cliente:</label>
      <input type="text" list="clientes" id="cliente" (change)="selectedClient($event)" (input)="selectedClient($event)" />
      
      <datalist id="clientes">
        <option *ngFor="let cliente of clientes" [value]="cliente.NombreCliente"></option>
      </datalist>

      <p *ngIf="!isClienteValido && clienteSeleccionado">El cliente seleccionado no es válido.</p>

      <label for="telefono">Teléfono</label>
      <input type="text" id="telefono" name="telefono" [(ngModel)]="phoneNumberInput" disabled>

      <label for="email">Email</label>
      <input type="text" id="email" name="email" [(ngModel)]="mailInput" disabled>

      <label for="vendedor">Vendedor</label>
      <input type="text" id="vendedor" name="vendedor">

      <label for="fecha">Fecha</label>
      <input type="date" id="fecha" name="fecha" value="{{ todayDate }}" disabled>

      <label for="forma-pago">Forma de pago</label>
      <select id="forma-pago" name="forma-pago">
        <option value="efectivo">Efectivo</option>
        <option value="debito">Débito</option>
        <option value="credito">Crédito</option>
      </select>
    </div>

    <!-- Segunda fila -->
    <div class="button-row">
      <button class="add-product-button" (click)="openModal()">Agregar productos</button>
    </div>

    <!-- Tercera fila -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Código</th>
            <th>Nombre del producto</th>
            <th>Cantidad</th>
            <th>Precio Unit.</th>
            <th>Total</th>
            <th>
          </tr>
        </thead>
        <tbody>
          <!-- Aquí irían las filas de productos -->
          <tr class="trow-data" *ngFor="let detalle of detalles; let i = index">
            <td>{{ detalles[i].IdDetalleFactura! + 1 }}</td>
            <td>{{ detalles[i].Producto?.NombreProducto}}</td>
            <!-- <td>{{ detalles[i].Producto?.IdProducto}}</td> -->
            <td>{{ detalles[i].Cantidad}}</td>
            <td>{{ detalles[i].PrecioUnitario | currency }}</td>
            <td>{{ detalles[i].Total | currency }}</td>
            <td>
                <button class="btn-action btn-red" (click)="substractProductToInvoice(detalle)">Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="spacing-container">
      <span class="total-label">Total:</span>
      <span class="total-value">{{ totalInvoice | currency }}</span>
    </div>
  </div>
</div>

<!-- Modal Component -->
<app-AddInvoiceDetailModal 
    *ngIf="isModalOpen"
    [isOpen]="isModalOpen"
    (detailCreated)="addProductToInvoice($event)"
    (closeModal)="isModalOpen = false">
</app-AddInvoiceDetailModal>



